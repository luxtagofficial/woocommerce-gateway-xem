{"version":3,"sources":["xem-checkout.js"],"names":["$","xemPayment","init","initialize","length","this","form","email","data","amount","currency","xemAddress","xemAmount","xemRef","infoWrapper","amountWrapper","process","paymentData","v","wc_xem_params","test","type","addr","toUpperCase","replace","msg","name","store","QRCode","text","JSON","stringify","size","fill","quiet","ratio","ClipboardJS","isSupported","$withClipboard","each","i","el","tooltip","document","createElement","setAttribute","appendChild","addEventListener","setTimeout","removeAttribute","is","attr","on","options","classname","id","target","getElementById","nanobar","Nanobar","updateXemAmount","ajaxGetXemAmount","done","res","console","log","success","checkForXemPayment","go","ajax","url","wc_ajax_url","action","nounce","html","match","trigger","jQuery"],"mappings":"CAAA,SAAAA,GACA,GAAAC,IACAC,KAAA,WACAF,EAAAG,WAAA,UAAA,WAEAH,EAAA,aAAAI,SACAC,KAAAC,KAAAN,EAAA,aACAK,KAAAE,MAAAF,KAAAC,KAAAE,KAAA,SACAH,KAAAI,OAAAJ,KAAAC,KAAAE,KAAA,UACAH,KAAAK,SAAAL,KAAAC,KAAAE,KAAA,YACAH,KAAAM,WAAAN,KAAAC,KAAAE,KAAA,eACAH,KAAAO,UAAAP,KAAAC,KAAAE,KAAA,cACAH,KAAAQ,OAAAR,KAAAC,KAAAE,KAAA,WACAH,KAAAS,YAAA,YACAT,KAAAU,cAAA,sBACAV,KAAAW,QAAA,gBAKAX,KAAAY,aACAC,EAAAC,cAAAC,KAAA,EAAA,EACAC,KAAA,EACAb,MACAc,KAAAjB,KAAAM,WAAAY,cAAAC,QAAA,KAAA,IACAf,OAAA,IAAAJ,KAAAO,UACAa,IAAApB,KAAAQ,OACAa,KAAA,kBAAAP,cAAAQ,QAIA,GAAAC,QAAA,UACAC,KAAAC,KAAAC,UAAA1B,KAAAY,aACAe,KAAA,IACAC,KAAA,OACAC,MAAA,EACAC,MAAA,IAIAC,YAAAC,gBACA,GAAAD,aAAA,uBACA,GAAAA,aAAA,wBACA,GAAAA,aAAA,oBAGAE,eAAAtC,EAAA,+CACAsC,eAAAC,KAAA,SAAAC,EAAAC,GACA,KAAAC,GAAAC,SAAAC,cAAA,OACAF,GAAAG,aAAA,aAAA,UACAJ,EAAAK,YAAAJ,GACAD,EAAAM,iBAAA,QAAA,WACAL,EAAAG,aAAA,mBAAA,MACAH,EAAAG,aAAA,uBAAA,QACAG,WAAA,WACAN,EAAAO,gBAAA,wBACAP,EAAAO,gBAAA,qBACA,UAMAjD,EAAA,sCAAAkD,GAAA,YACAlD,EAAA,gBAAAmD,KAAA,YAAA,GAEAnD,EAAA,gBAAAmD,KAAA,YAAA,GAIAnD,EAAA,6BAAAoD,GAAA,QAAA,+BAAA,WACApD,EAAAK,MAAA6C,GAAA,uBACAlD,EAAA,gBAAAmD,KAAA,YAAA,GAEAnD,EAAA,gBAAAmD,KAAA,YAAA,IAIA,IAAAE,IACAC,UAAA,cACAC,GAAA,cACAC,OAAAb,SAAAc,eAAA,eAGAxD,GAAAyD,QAAA,GAAAC,SAAAN,MAGAO,gBAAA,WACAvD,KAAAwD,mBAAAC,KAAA,SAAAC,GACAC,QAAAC,IAAAF,IAEA,IAAAA,EAAAG,SAAAH,EAAAvD,KAAAC,OAAA,GACAT,EAAAK,KAAAU,eAAAc,KAAAkC,EAAAvD,KAAAC,WAKA0D,mBAAA,WACA9D,KAAAqD,QAAAU,GAAA,IACApE,EAAAqE,MACAC,IAAAnD,cAAAoD,YACAlD,KAAA,OACAb,MACAgE,OAAA,gCACAC,OAAAtD,cAAAsD,UAEAX,KAAA,SAAAC,GACA/D,EAAA,cAAA0E,KAAA,qCAGA,IAAAX,EAAAG,UAAA,IAAAH,EAAAvD,KAAAmE,QACA3E,EAAA,gBAAAmD,KAAA,YAAA,GACAnD,EAAA,gBAAA4E,QAAA,UAEA5B,WAAA,WACA/C,EAAAkE,sBACA,OAEA9D,KAAAqD,QAAAU,GAAA,MAGAP,iBAAA,WACA,MAAA7D,GAAAqE,MACAC,IAAAnD,cAAAoD,YACAlD,KAAA,OACAb,MACAgE,OAAA,6BACAC,OAAAtD,cAAAsD,WAMAxE,GAAAC,OACA8C,WAAA,WACA/C,EAAAkE,sBACA,MAEAU","file":"../xem-checkout.min.js","sourcesContent":["(function( $ ) {\n    var xemPayment = {\n        init: function () {\n            $.initialize(\"#xem-qr\", function() {\n                //Get form\n                if ( $( '#xem-form' ).length ) {\n                    this.form = $('#xem-form');\n                    this.email = this.form.data('email');\n                    this.amount = this.form.data('amount');\n                    this.currency = this.form.data('currency');\n                    this.xemAddress = this.form.data('xem-address');\n                    this.xemAmount = this.form.data('xem-amount');\n                    this.xemRef = this.form.data('xem-ref');\n                    this.infoWrapper = '#xem-info';\n                    this.amountWrapper = '#xem-amount-wrapper';\n                    this.process = '#xem-process';\n                }\n\n                //Prepare NEM qr code data\n                // Invoice model for QR\n                this.paymentData = {\n                    \"v\": wc_xem_params.test ? 1 : 2,\n                    \"type\": 2,\n                    \"data\": {\n                        \"addr\": this.xemAddress.toUpperCase().replace(/-/g, ''),\n                        \"amount\": this.xemAmount * 1000000,\n                        \"msg\": this.xemRef,\n                        \"name\": \"XEM payment to \" + wc_xem_params.store\n                    }\n                };\n                //Generate the QR code with address\n                new QRCode(\"xem-qr\", {\n                    text: JSON.stringify(this.paymentData),\n                    size: 256,\n                    fill: '#000',\n                    quiet: 0,\n                    ratio: 2\n                });\n\n                /*Add copy functinality to amount, ref and nem address*/\n                if(ClipboardJS.isSupported()){\n                    new ClipboardJS('#xem-amount-wrapper');\n                    new ClipboardJS('#xem-address-wrapper');\n                    new ClipboardJS('#xem-ref-wrapper');\n\n                    // initialize clipboard tooltip\n                    $withClipboard = $('.xem-payment-desc-row [data-clipboard-text]')\n                    $withClipboard.each(function(i, el) {\n                        const tooltip = document.createElement('span');\n                        tooltip.setAttribute('aria-label', 'copied');\n                        el.appendChild(tooltip)\n                        el.addEventListener('click', function() {\n                            tooltip.setAttribute('data-balloon-pos', 'up');\n                            tooltip.setAttribute('data-balloon-visible', 'true');\n                            setTimeout(function() {\n                                tooltip.removeAttribute('data-balloon-visible');\n                                tooltip.removeAttribute('data-balloon-pos');\n                            }, 350)\n                        })\n                    })\n                }\n\n                //Set payment button to disabled if whole chech is updated.\n                if($( 'div.payment_box.payment_method_xem' ).is(':visible')){\n                    $( '#place_order' ).attr( 'disabled', true);\n                }else{\n                    $( '#place_order' ).attr( 'disabled', false)\n                }\n\n                /*Set pay button to disabled and start waiting for payments*/\n                $('.wc_payment_methods  > li').on( 'click', 'input[name=\"payment_method\"]',function () {\n                    if ( $( this ).is( '#payment_method_xem' ) ) {\n                        $( '#place_order' ).attr( 'disabled', true);\n                    }else{\n                        $( '#place_order' ).attr( 'disabled', false)\n                    }\n                });\n\n                var options = {\n                    classname: 'nanobar-xem',\n                    id: 'xem-nanobar',\n                    target: document.getElementById('xem-process')\n                };\n\n                xemPayment.nanobar = new Nanobar( options );\n            });\n        },\n        updateXemAmount: function () {\n            this.ajaxGetXemAmount().done(function (res) {\n                console.log(res);\n\n                if(res.success === true && res.data.amount > 0){\n                    $(this.amountWrapper).text(res.data.amount)\n                }\n            });\n\n        },\n        checkForXemPayment: function () {\n            this.nanobar.go(25);\n            $.ajax({\n                url: wc_xem_params.wc_ajax_url,\n                type: 'post',\n                data: {\n                    action: 'woocommerce_check_for_payment',\n                    nounce: wc_xem_params.nounce\n                }\n            }).done(function (res) {\n                $('#xem-check').html('<p id=\"xem-check\">Checking..</p>');\n                //console.log(res);\n                //console.log(\"Match: \" + res.data.match);\n                if(res.success === true && res.data.match === true){\n                    $( '#place_order' ).attr( 'disabled', false);\n                    $( '#place_order' ).trigger( 'click');\n                }\n                setTimeout(function() {\n                    xemPayment.checkForXemPayment();\n                }, 5000);\n            });\n            this.nanobar.go(100);\n        },\n\n        ajaxGetXemAmount: function () {\n            return $.ajax({\n                url: wc_xem_params.wc_ajax_url,\n                type: 'post',\n                data: {\n                    action: 'woocommerce_get_xem_amount',\n                    nounce: wc_xem_params.nounce\n                }\n            })\n        }\n    };\n\n    xemPayment.init();\n    setTimeout(function() {\n        xemPayment.checkForXemPayment();\n    }, 5000);\n\n})( jQuery );"]}